/*!CK:3683521529!*//*1395842183,178183207*/

if (self.CavalryLogger) { CavalryLogger.start_js(["RHOZV"]); }

__d("CSSAnimations",["CSS","cx"],function(a,b,c,d,e,f,g,h){var i="_3yk",j=750,k={bounce:function(l){g.addClass(l,i);setTimeout(g.removeClass.bind(null,l,i),j);},getBounceTimeout:function(){return j;}};e.exports=k;});
__d("GraphQLQuery",["createObjectFrom"],function(a,b,c,d,e,f,g){function h(){"use strict";}h.prototype.addField=function(l){"use strict";if(this.fieldSet){this.fieldSet.fields.push(l);}else this.fieldSet=new k.FieldSet([l]);};h.prototype.addFields=function(l){"use strict";l.forEach(this.addField,this);};for(var i in h)if(h.hasOwnProperty(i))k[i]=h[i];var j=h===null?null:h.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=h;function k(l,m){"use strict";this.rootCall=l;this.fieldSet=m;}k.prototype.toString=function(){"use strict";return (this.rootCall||'')+(this.fieldSet||'');};k.Call=(function(){function l(m,n){"use strict";this.name=m;this.args=n||[];}l.prototype.toString=function(){"use strict";return this.name+'('+this.args.join(',')+')';};return l;})();k.CallValue=(function(){function l(m){"use strict";this.callValue=m;}l.prototype.toString=function(){"use strict";return this.callValue.replace(/[)(}{><,.\\]/g,'\\$&');};return l;})();k.CallVariable=(function(){function l(m){"use strict";this.callVariableName=m;}l.prototype.toString=function(){"use strict";return '<'+this.callVariableName+'>';};return l;})();k.Field=(function(){for(i in h)if(h.hasOwnProperty(i))l[i]=h[i];l.prototype=Object.create(j);l.prototype.constructor=l;l.__superConstructor__=h;function l(m,n,o,p,q){"use strict";this.name=p||m;this.fieldName=m;this.calls=n||[];this.fieldSet=o;this.alias=p;this.condition=q;}l.prototype.toString=function(){"use strict";var m='';if(this.condition)m+=this.condition+'?';m+=this.fieldName;if(this.calls.length!==0)m+='.'+this.calls.join('.');if(this.alias)m+=' as '+this.alias;if(this.fieldSet)m+=this.fieldSet;return m;};l.prototype.addCall=function(m){"use strict";this.calls.push(m);};l.prototype.removeCalls=function(m){"use strict";var n=g(m),o=[];for(var p=0;p<this.calls.length;p++)if(!n[this.calls[p].name])o.push(this.calls[p]);this.calls=o;};return l;})();k.FieldSet=(function(){function l(m){"use strict";this.fields=m||[];}l.prototype.toString=function(){"use strict";return '{'+this.fields.join(',')+'}';};return l;})();e.exports=k;});
__d("GraphQLParser",["GraphQLQuery"],function(a,b,c,d,e,f,g){function h(l){"use strict";this.queryString=l;this.queryLength=l.length;this.index=-1;this.character=null;this.next();}h.prototype.error=function(l){"use strict";throw new h.SyntaxError(this.queryString,this.index,l);};h.prototype.next=function(l){"use strict";if(l&&l!==this.character)this.error('Expected "'+l+'" instead of "'+this.character+'".');this.index++;if(this.index>this.queryLength){this.error('Expected another character, but at end of string.');}else this.character=this.index===this.queryLength?null:this.queryString[this.index];};h.prototype.end=function(){"use strict";if(this.character)this.error('Expected end of string instead of '+this.character+'.');};h.prototype.whitespace=function(){"use strict";while(this.character===' '||this.character==='\t'||this.character==='\r'||this.character==='\n')this.next();};h.prototype.query=function(l){"use strict";var m=null;if(l){m=new g.Call(this.name(),this.callArguments());this.whitespace();}var n=null;if(this.character==='{')n=this.fieldSet();return new g(m,n);};h.prototype.name=function(){"use strict";var l=this.index;if(this.character===':')this.error('Name cannot begin with :');while(j(this.character))this.next();if(this.index===l)this.error('Expected name.');return this.queryString.substr(l,this.index-l);};h.prototype.fieldSet=function(){"use strict";var l=[];this.next('{');this.whitespace();l.push(this.field());this.whitespace();while(this.character===','){this.next(',');this.whitespace();l.push(this.field());this.whitespace();}this.next('}');return new g.FieldSet(l);};h.prototype.field=function(){"use strict";var l,m,n=this.name();this.whitespace();if(this.character==='?'){this.next('?');this.whitespace();l=this.name();m=n;}else l=n;this.whitespace();var o=this.calls(),p;if(this.character==='a'){this.next('a');this.next('s');this.whitespace();p=this.name();}this.whitespace();var q;if(this.character==='{')q=this.fieldSet();return new g.Field(l,o,q,p,m);};h.prototype.calls=function(){"use strict";var l=[];while(this.character==='.'){this.next('.');this.whitespace();l.push(new g.Call(this.name(),this.callArguments()));this.whitespace();}return l;};h.prototype.callArguments=function(){"use strict";this.next('(');this.whitespace();var l=[];if(this.character!==')'){l.push(this.callArgument());while(this.character===','){this.next(',');this.whitespace();l.push(this.callArgument());}}this.next(')');return l;};h.prototype.callArgument=function(){"use strict";return this.character==='<'?this.callVariable():this.callValue();};h.prototype.callVariable=function(){"use strict";this.next('<');var l=this.name();this.next('>');return new g.CallVariable(l);};h.prototype.callValue=function(){"use strict";var l=this.index,m=false;while(k(this.character)){if(this.character==='\\'){this.next();m=true;}this.next();}if(this.index===l)this.error('Expected call value.');var n=this.index-l,o=this.queryString.substr(l,n);o=o.replace(/\s+$/,'');if(m)for(var p=0;p<n;++p)if(o[p]==='\\'){o=o.substr(0,p)+o.substr(p+1);--n;}return new g.CallValue(o);};h.SyntaxError=(function(){for(var l in Error)if(Error.hasOwnProperty(l))n[l]=Error[l];var m=Error===null?null:Error.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=Error;function n(o,p,q){"use strict";this.queryString=o;this.character=p;this.parserError=q;this.message='Syntax error "'+q+'" '+'at character '+p+' '+'near "'+i(o,p)+'" '+'in query: '+o;}return n;})();function i(l,m){return (l.substr(0,m+1).replace(/\s+/g,' ').substr(-10)+'\u20DD'+l.substr(m+1).replace(/\s+/g,' ').substr(0,10));}function j(l){if(l===null)return false;return l==='_'||l===':'||l==='-'||(l>='0'&&l<='9')||(l>='A'&&l<='Z')||(l>='a'&&l<='z');}function k(l){if(l===null)return false;return l!='('&&l!=')'&&l!='{'&&l!='}'&&l!='<'&&l!='>'&&l!='.'&&l!=',';}h.parseQuery=function(l){var m=new h(l);m.whitespace();var n=m.query(true);m.whitespace();m.end();return n;};h.parseRootlessQuery=function(l){var m=new h(l);m.whitespace();var n=m.query(false);m.whitespace();m.end();return n;};e.exports=h;});
__d("PagedQuery",["GraphQLParser","GraphQLQuery","keyOf","isEmpty"],function(a,b,c,d,e,f,g,h,i,j){function k(l,m){"use strict";this.$PagedQuery0=l;this.$PagedQuery1=m;}k.prototype.$PagedQuery2=function(){"use strict";var l=this.findFieldByPath(this.$PagedQuery0);l.removeCalls(['find','after','before','first','last']);return l;};k.prototype.$PagedQuery3=function(l,m,n){"use strict";var o=this.$PagedQuery2(),p=n?'after':'before';o.addCall(new h.Call(p,[l]));var q=n?'first':'last';o.addCall(new h.Call(q,[m]));return this.$PagedQuery0.toString();};k.prototype.$PagedQuery4=function(l){"use strict";var m=this.$PagedQuery1[l];if(typeof m=='object'&&!j(m))return i(m);return null;};k.prototype.$PagedQuery5=function(l){"use strict";var m=this.$PagedQuery4(l);if(m)return m;return this.$PagedQuery1[l];};k.prototype.$PagedQuery6=function(l){"use strict";var m=this.$PagedQuery4(l);if(m)return this.$PagedQuery1[l][m];return this.$PagedQuery1[l];};k.prototype.pageAfterQueryString=function(l,m){"use strict";return this.$PagedQuery3(l,m,true);};k.prototype.pageBeforeQueryString=function(l,m){"use strict";return this.$PagedQuery3(l,m,false);};k.prototype.pageFirstQueryString=function(l){"use strict";var m=this.$PagedQuery2();m.addCall(new h.Call('first',[l]));return this.$PagedQuery0.toString();};k.prototype.pageLastQueryString=function(l){"use strict";var m=this.$PagedQuery2();m.addCall(new h.Call('last',[l]));return this.$PagedQuery0.toString();};k.prototype.findFieldByPath=function(l){"use strict";var m=l,n=this.$PagedQuery5(0);if(l.rootCall.name!=n)throw new Error("Query path does not match root query at top node, "+"expected "+n+", "+"found "+l.name+" instead.");for(var o=1;o<this.$PagedQuery1.length;o++){var p=m.fieldSet.fields,q=false,r=this.$PagedQuery5(o);for(var s=0;s<p.length;s++)if(p[s].fieldName==r){m=p[s];q=true;break;}if(!q)throw new Error("Query path does not match query structure at location "+o+", "+"expected "+r+", "+"not located in "+p);}return m;};k.prototype.findDataByPath=function(l){"use strict";var m=l;for(var n=0;n<this.$PagedQuery1.length;n++){var o=this.$PagedQuery6(n);if(!m||!m[o])throw new Error("Query path does not match payload at location "+n+", "+"expected "+o);m=m[o];}return m;};k.constructFromPath=function(l,m){return new k(g.parseQuery(l),m);};e.exports=k;});
__d("PagedQueryCache",["KeyedCallbackManager","GraphQLParser","emptyFunction","merge","mergeInto"],function(a,b,c,d,e,f,g,h,i,j,k){function l(m,n,o,p){"use strict";this.$PagedQueryCache0=this.$PagedQueryCache0.bind(this,m),this.$PagedQueryCache1=n;this.$PagedQueryCache2=j({enableLooping:false},p);var q=this.$PagedQueryCache1.findDataByPath(o),r=q.edges;this.$PagedQueryCache3=q.page_info;this.$PagedQueryCache4=new g();this.$PagedQueryCache5={};this.$PagedQueryCache6={};this.$PagedQueryCache7={};this.$PagedQueryCache8=0;this.$PagedQueryCache9=0;this.$PagedQueryCachea={};this.$PagedQueryCacheb(r,0);if(this.$PagedQueryCache2.allDataLoaded)this.$PagedQueryCachec();}l.prototype.$PagedQueryCache0=function(m,n,o,p,q,r,s){"use strict";var t=h.parseQuery(n),u=o.findFieldByPath(t),v={};for(var w=0;w<u.calls.length;w++){var x=u.calls[w];v[x.name]=x.args[0].callValue;}k(v,r);m(n,o,p,q,v,s);};l.prototype.$PagedQueryCacheb=function(m,n){"use strict";var o={},p=false;for(var q=0;q<m.length;q++){if(this.hasLooped())break;var r=n+q,s=m[q].cursor,t=m[q].node,u=this.$PagedQueryCache5[s];if(this.$PagedQueryCache2.enableLooping&&u!==undefined){p=true;continue;}var v=this.$PagedQueryCache4.getResource(r);if(v!==undefined&&v!=s)throw new Error('Attempting to add cursor '+s+' at location '+r+' which already contains cursor '+v);this.$PagedQueryCache7[t.id]=s;this.$PagedQueryCache6[s]=t;o[r]=s;this.$PagedQueryCache5[s]=r;this.$PagedQueryCache8=Math.min(r,this.$PagedQueryCache8);this.$PagedQueryCache9=Math.max(r,this.$PagedQueryCache9);}if(p)this.$PagedQueryCachec();this.$PagedQueryCache4.addResourcesAndExecute(o);};l.prototype.getItemsAfterCursor=function(m,n,o){"use strict";return this.$PagedQueryCached(m,n,true,o);};l.prototype.getItemsBeforeCursor=function(m,n,o){"use strict";return this.$PagedQueryCached(m,n,false,o);};l.prototype.$PagedQueryCachee=function(m){"use strict";if(!this.hasLooped())return m;var n=this.$PagedQueryCachef.end-this.$PagedQueryCachef.start+1;while(m<this.$PagedQueryCachef.start||m>this.$PagedQueryCachef.end)if(m<this.$PagedQueryCachef.start){m+=n;}else m-=n;return m;};l.prototype.$PagedQueryCached=function(m,n,o,p){"use strict";var q=this.$PagedQueryCacheg(m);if(!o)q=q-n-1;var r=[];for(var s=1;s<=n;s++)r.push(this.$PagedQueryCachee(q+s));var t=this.$PagedQueryCache4.getUnavailableResourcesFromRequest(r);if(t.length){t=this.$PagedQueryCacheh(t);if(!t.length)return;var u;if(o){if(this.$PagedQueryCache2.enableLooping&&!this.hasNextPage(m)){u=this.$PagedQueryCache1.pageFirstQueryString(n);}else u=this.$PagedQueryCache1.pageAfterQueryString(m,n);}else if(this.$PagedQueryCache2.enableLooping&&!this.hasPreviousPage(m)){u=this.$PagedQueryCache1.pageLastQueryString(n);}else u=this.$PagedQueryCache1.pageBeforeQueryString(m,n);for(var v=0;v<t.length;++v)this.$PagedQueryCachea[t[v]]=true;this.$PagedQueryCachei&&this.$PagedQueryCachei();this.$PagedQueryCache0(u,this.$PagedQueryCache1,t,o?this.$PagedQueryCache2.first_query:this.$PagedQueryCache2.last_query,this.$PagedQueryCache2.persistent_params,this.$PagedQueryCachej.bind(this));}var w=function(x){var y=[];for(var z=0;z<n;z++)y.push(this.$PagedQueryCache6[x[r[z]]]);return y;}.bind(this);return this.$PagedQueryCache4.deferredExecuteOrEnqueue(r).then(w).addCallback(p,this);};l.prototype.$PagedQueryCachej=function(){"use strict";this.$PagedQueryCachek.apply(this,arguments);};l.prototype.$PagedQueryCacheg=function(m){"use strict";var n=this.$PagedQueryCache5[m];if(n===undefined)throw new Error("Cursor not found: the request can still be made but the result "+"would not link to the existing data");return n;};l.prototype.setPayloadCallback=function(m){"use strict";this.$PagedQueryCachek=m;};l.prototype.updateData=function(m){"use strict";var n=this.$PagedQueryCache1.findDataByPath(m.query_results),o=n&&n.edges;if(!o)return;for(var p=0;p<o.length;++p)this.$PagedQueryCache6[o[p].cursor]=o[p].node;};l.prototype.addData=function(m){"use strict";var n=false,o=null,p=0;for(var q in m.query_params){if(q=='after'||q=='before')o=m.query_params[q];if(q=='first'||q=='last'){n=(q=='first');p=m.query_params[q];}}if(this.$PagedQueryCache2.enableLooping&&!o)o=n?this.$PagedQueryCache3.end_cursor:this.$PagedQueryCache3.start_cursor;if(!o||this.$PagedQueryCache5[o]===undefined)return;var r=this.$PagedQueryCache5[o],s=this.$PagedQueryCache1.findDataByPath(m.query_results);if(!s.edges.length){this.$PagedQueryCachel(m.requested_indices);if(n){this.$PagedQueryCache3.has_next_page=false;this.$PagedQueryCache2.enableLooping&&this.getItemsAfterCursor(o,p,i);}else{this.$PagedQueryCache3.has_previous_page=false;this.$PagedQueryCache2.enableLooping&&this.getItemsBeforeCursor(o,p,i);}return;}var t;if(n){t=r+1;this.$PagedQueryCache3.end_cursor=s.page_info.end_cursor;this.$PagedQueryCache3.has_next_page=s.page_info.has_next_page;}else{t=r-s.edges.length;this.$PagedQueryCache3.start_cursor=s.page_info.start_cursor;this.$PagedQueryCache3.has_previous_page=s.page_info.has_previous_page;}this.$PagedQueryCacheb(s.edges,t);this.$PagedQueryCachel(m.requested_indices);};l.prototype.hasNextPage=function(m){"use strict";var n=this.$PagedQueryCacheg(m);if(this.$PagedQueryCache4.getResource(n+1)){return true;}else if(m==this.$PagedQueryCache3.end_cursor){return this.$PagedQueryCache3.has_next_page;}else throw new Error('hasNextPage called on unknown cursor');};l.prototype.hasPreviousPage=function(m){"use strict";var n=this.$PagedQueryCacheg(m);if(this.$PagedQueryCache4.getResource(n-1)){return true;}else if(m==this.$PagedQueryCache3.start_cursor){return this.$PagedQueryCache3.has_previous_page;}else throw new Error('hasPreviousPage called on unknown cursor');};l.prototype.hasLooped=function(){"use strict";return this.$PagedQueryCache2.enableLooping&&this.$PagedQueryCachef;};l.prototype.getItemAtIndex=function(m,n){"use strict";m=this.$PagedQueryCachee(m);var o=function(p){n(this.$PagedQueryCache6[p[m]]);}.bind(this);this.$PagedQueryCache4.deferredExecuteOrEnqueue([m]).addCallback(o,this);};l.prototype.getItemAtIndexImmediate=function(m){"use strict";m=this.$PagedQueryCachee(m);var n=this.$PagedQueryCache4.getResource(m),o;if(n)o=this.$PagedQueryCache6[n];return o;};l.prototype.getAvailableRange=function(){"use strict";var m=this.$PagedQueryCacheg(this.$PagedQueryCache3.start_cursor),n=this.$PagedQueryCacheg(this.$PagedQueryCache3.end_cursor);return {offset:m,length:n-m+1};};l.prototype.getCursorForID=function(m){"use strict";return this.$PagedQueryCache7[m];};l.prototype.getIndexForID=function(m){"use strict";var n=this.getCursorForID(m);return (n!==undefined)?this.$PagedQueryCache5[n]:undefined;};l.prototype.$PagedQueryCachel=function(m){"use strict";if(m)for(var n=0;n<m.length;++n)delete(this.$PagedQueryCachea[m[n]]);};l.prototype.$PagedQueryCacheh=function(m){"use strict";if(!this.$PagedQueryCachea)return m;var n=[];for(var o=0;o<m.length;++o)if(!this.$PagedQueryCachea[m[o]])n.push(m[o]);return n;};l.prototype.$PagedQueryCachec=function(){"use strict";this.$PagedQueryCachef={start:this.$PagedQueryCache8,end:this.$PagedQueryCache9};};l.prototype.setPreFetchCallback=function(m){"use strict";this.$PagedQueryCachei=m;};e.exports=l;});
__d("PhotoStorePagedQueryCacheCore",["PagedQuery","PagedQueryCache","merge"],function(a,b,c,d,e,f,g,h,i){for(var j in h)if(h.hasOwnProperty(j))l[j]=h[j];var k=h===null?null:h.prototype;l.prototype=Object.create(k);l.prototype.constructor=l;l.__superConstructor__=h;function l(m,n){"use strict";var o=m.query_results,p=m.query_metadata,q=g.constructFromPath(p.query_string,p.query_path);this.$PhotoStorePagedQueryCacheCore0=m.set_id;this.$PhotoStorePagedQueryCacheCore1=m.payloadsource;k.constructor.call(this,n,q,o,i({enableLooping:true},p.config));this.setPayloadCallback(this.$PhotoStorePagedQueryCacheCore2.bind(this));}l.prototype.$PhotoStorePagedQueryCacheCore2=function(m){"use strict";m.set_id=this.$PhotoStorePagedQueryCacheCore0;this.broadcastUpdate(this.$PhotoStorePagedQueryCacheCore1,m);};l.prototype.broadcastUpdate=function(m,n){"use strict";};e.exports=l;});
__d("Selectable",["Arbiter","ArbiterMixin","CSS","DataStore","DOM","DOMQuery","Event","Style","TextSelection","Vector","cx","getOverlayZIndex","shield","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u=new g(),v=k.create('div',{className:"_102"}),w,x,y,z,aa,ba;function ca(event){if(event.isRightClick()||event.isMiddleClick())return;var pa=event.getTarget();while(pa){var qa=pa.getAttribute&&pa.getAttribute("data-selectable");switch(qa){case "click":ba=true;aa=false;break;case "lasso":ba=false;aa=true;break;case "both":ba=true;aa=true;break;case "none":return;default:pa=pa.parentNode;continue;}break;}if(!pa)return;if(aa){o.clearSelection();event.prevent();}var ra=m.getPosition(event);w=ra.x;x=ra.y;y=event.getTarget();z=false;if(!event.ctrlKey&&!event.shiftKey&&!event.altKey&&!event.metaKey){u.inform("deselect");}else event.prevent();}function da(event){if(typeof w==="undefined")return;if(!aa)return;z=true;if(!v.parentNode){var pa=r(y,document.body);n.set(v,'z-index',pa);k.appendContent(document.body,v);}var qa=m.getPosition(event),ra=ja(w,x,qa.x,qa.y);u.inform("lasso",ra);}function ea(event){if(typeof w==="undefined")return;var pa=event.getTarget();if(z){var qa=m.getPosition(event),ra=ja(w,x,qa.x,qa.y);u.inform("lasso",ra);}else if(y===pa&&ba){var sa,ta=event.getTarget();while(ta){sa=j.get(ta,"selectable-data");if(sa)break;ta=ta.parentNode;}if(sa&&sa.instance)sa.instance._clickHandler({elem:ta,meta:event.ctrlKey||event.altKey||event.metaKey,shift:event.shiftKey});}k.remove(v);u.inform("select");y=null;w=undefined;z=false;}u.subscribe("lasso",function(pa,qa){n.set(v,"left",qa.minX+"px");n.set(v,"top",qa.minY+"px");n.set(v,"width",(qa.maxX-qa.minX)+"px");n.set(v,"height",(qa.maxY-qa.minY)+"px");});var fa=0,ga;function ha(){if(fa++!==0)return;ga={down:m.listen(document.documentElement,"mousedown",ca),move:m.listen(document.documentElement,"mousemove",da),up:m.listen(document.documentElement,"mouseup",ea)};}function ia(){if(--fa!==0)return;ga.down.remove();ga.move.remove();ga.up.remove();}function ja(pa,qa,ra,sa){var ta;if(pa>ra){ta=pa;pa=ra;ra=ta;}if(qa>sa){ta=qa;qa=sa;sa=ta;}return {minX:pa,minY:qa,maxX:ra,maxY:sa};}function ka(pa,qa){if(pa.minX===pa.maxX&&pa.minY===pa.maxY)return false;if(qa.minX===qa.maxX&&qa.minY===qa.maxY)return false;return (pa.maxX>=qa.minX&&pa.maxY>=qa.minY&&qa.maxX>=pa.minX&&qa.maxY>=pa.minY);}var la=t(h);for(var ma in la)if(la.hasOwnProperty(ma))oa[ma]=la[ma];var na=la===null?null:la.prototype;oa.prototype=Object.create(na);oa.prototype.constructor=oa;oa.__superConstructor__=la;function oa(pa,qa,ra,sa){"use strict";this._root=pa;this._selector=qa;this._selected=ra;sa=sa||{};this._sticky=(sa.sticky!==false);this._elements=[];this._attachListeners();this.rematch();}oa.prototype._lassoHandler=function(pa,qa){"use strict";var ra=this._elements,sa=ra.length;while(sa-->0){var ta=ra[sa],ua=j.get(ta,"selectable-data");if(!ua)continue;if(ua.lassoed^ka(ua.bounds,qa)){ua.lassoed=!ua.lassoed;i.toggleClass(ra[sa],this._selected);this._lassoAffected=true;}}};oa.prototype._selectHandler=function(pa){"use strict";if(this._lassoAffected){this._elements.forEach(function(qa){var ra=j.get(qa,"selectable-data");if(!ra)return;ra.lassoed=false;});this._changed=true;this._lassoAffected=false;this._primary=null;}if(this._changed){this._changed=false;this._selection();}};oa.prototype._deselectHandler=function(pa){"use strict";if(!this._sticky)if(this.deselect())this._changed=true;};oa.prototype._clickHandler=function(pa){"use strict";var qa=this._selected;if(pa.meta||(pa.shift&&!this._primary)){i.toggleClass(pa.elem,qa);this._primary=pa.elem;this._secondary=null;}else if(pa.shift&&this._primary){if(this._secondary)this.range(this._primary,this._secondary).forEach(function(ra){i.removeClass(ra,qa);});this.range(this._primary,pa.elem).forEach(function(ra){i.addClass(ra,qa);});this._secondary=pa.elem;}else if(this._sticky){i.toggleClass(pa.elem,qa);if(i.hasClass(pa.elem,qa)){this._primary=pa.elem;}else this._primary=null;this._secondary=null;}else{this._elements.forEach(function(ra){i.removeClass(ra,qa);});i.addClass(pa.elem,qa);this._primary=pa.elem;this._secondary=null;}this._changed=true;};oa.prototype._selection=function(){"use strict";var pa=this._selected,qa=this._elements,ra=[];for(var sa=0;sa<qa.length;sa++)if(i.hasClass(qa[sa],pa))ra.push(qa[sa]);this.inform("selection",ra);};oa.prototype.selectAll=function(){"use strict";var pa=this._selected,qa=this._elements;for(var ra=0;ra<qa.length;ra++)i.addClass(qa[ra],pa);this.inform("selection",qa);};oa.prototype.setSticky=function(pa){"use strict";this._sticky=pa;};oa.prototype.deselect=function(){"use strict";var pa=false;this._elements.forEach(function(qa){if(pa||i.hasClass(qa,this._selected)){i.removeClass(qa,this._selected);pa=true;}}.bind(this));this._primary=null;return pa;};oa.prototype.range=function(pa,qa){"use strict";if(pa===qa)return [pa];var ra,sa,ta=this._elements;for(var ua=0;ua<ta.length;ua++)if(pa===ta[ua]){ra=ua;if(typeof sa!=="undefined")break;}else if(qa===ta[ua]){sa=ua;if(typeof ra!=="undefined")break;}if(ua===ta.length)return [];if(ra>sa){return ta.slice(sa,ra+1);}else return ta.slice(ra,sa+1);};oa.prototype._attachListeners=function(){"use strict";ha();var pa=m.listen(document.body,'mousedown',function(){this.reparent();pa.remove();}.bind(this),m.Priority.URGENT);this._subscriptions=[u.subscribe("lasso",this._lassoHandler.bind(this)),u.subscribe("select",this._selectHandler.bind(this)),u.subscribe("deselect",this._deselectHandler.bind(this))];this._listeners=[m.listen(window,"resize",s(this.recalculate,this)),pa];};oa.prototype._detachListeners=function(){"use strict";while(this._subscriptions.length)this._subscriptions.pop().unsubscribe();while(this._listeners.length)this._listeners.pop().remove();this._subscriptions=null;this._listeners=null;if(this._scrollListener){this._scrollListener.remove();this._scrollListener=null;}ia();};oa.prototype.rematch=function(){"use strict";var pa=l.scry(this._root,this._selector),qa=this._elements;for(var ra=0;ra<qa.length;ra++){for(var sa=0;sa<pa.length;sa++)if(qa[ra]===pa[sa])break;if(sa===pa.length)j.remove(qa[ra],"selectable-data");}this._elements=pa;this.recalculate(true);};oa.prototype.recalculate=function(pa){"use strict";var qa=this._elements;for(var ra=0;ra<qa.length;ra++)if(!pa||!j.get(qa[ra],"selectable-data")){var sa={instance:this},ta=p.getElementPosition(qa[ra]),ua=p.getElementDimensions(qa[ra]).add(ta);sa.bounds=ja(ta.x,ta.y,ua.x,ua.y);j.set(qa[ra],"selectable-data",sa);}};oa.prototype.reparent=function(){"use strict";if(this._scrollListener)this._scrollListener.remove();var pa=n.getScrollParent(this._root);if(pa&&pa!==window){this._scrollListener=m.listen(pa,'scroll',function(){this.recalculate();}.bind(this));}else this._scrollListener=null;this.recalculate();};oa.prototype.destroy=function(){"use strict";this._detachListeners();var pa=this._elements;for(var qa=0;qa<pa.length;qa++)j.remove(pa[qa],"selectable-data");this._elements=null;};e.exports=oa;});
__d("SubscribableSet",["ArbiterMixin","isScalar","mixin"],function(a,b,c,d,e,f,g,h,i){var j=i(g);for(var k in j)if(j.hasOwnProperty(k))m[k]=j[k];var l=j===null?null:j.prototype;m.prototype=Object.create(l);m.prototype.constructor=m;m.__superConstructor__=j;function m(n){"use strict";this._map={};this._items=[];if(n)n.forEach(this.add.bind(this));}m.prototype.contains=function(n){"use strict";return n in this._map;};m.prototype.add=function(n){"use strict";if(!this.contains(n)){this._items.push(n);this._map[n]=n;this.inform('add',{item:n});this.inform('change');}};m.prototype.addAll=function(n){"use strict";n.forEach(this.add.bind(this));};m.prototype.remove=function(n){"use strict";if(this.contains(n)){delete this._map[n];this._items.splice(this._items.indexOf(n),1);this.inform('remove',{item:n});this.inform('change');}};m.prototype.clear=function(){"use strict";this.getItems().forEach(this.remove.bind(this));};m.prototype.getLength=function(){"use strict";return this._items.length;};m.prototype.getItems=function(){"use strict";return this._items.slice(0);};e.exports=m;});
__d("sendPagedQueryRequestDefault",["AsyncRequest"],function(a,b,c,d,e,f,g){function h(i,j,k,l,m,n){new g('/ajax/graphql/query/').setData({queryName:l,params:m}).setHandler(function(o){var p=o.getPayload();n({requested_indices:k,query_results:JSON.parse(p.output),query_metadata:{query_string:p.query},query_params:m});}).setAllowCrossPageTransition(true).send();}e.exports=h;});
__d("BadgedButton",["Button.react","React","cx"],function(a,b,c,d,e,f,g,h,i){var j=h.createClass({displayName:'BadgedButton',render:function(){var k=this.props.count>1?this.props.pluralLabel:this.props.singularLabel,l=null;if(this.props.count>0)l=(h.DOM.div({className:(("_4_-d")+(this.props.bounce?' '+"_3yk":''))},this.props.count));return this.transferPropsTo(h.DOM.div({className:"_4_-e"},g({label:k,use:"confirm",size:"large",className:"_4_-f"}),l));}});e.exports=j;});
__d("PhotoCentralUpdates",["Arbiter","merge"],function(a,b,c,d,e,f,g,h){var i={handleUpdate:function(j,k){var l=h({payloadsource:j},k);g.inform('update-photos',l);},handlePhotoSets:function(j,k){var l=h({payloadsource:j},k);g.inform('update-photosets',l);}};e.exports=i;});
__d("PhotoStorePagedQueryCache",["PhotoCentralUpdates","PhotoStorePagedQueryCacheCore","sendPagedQueryRequestDefault"],function(a,b,c,d,e,f,g,h,i){for(var j in h)if(h.hasOwnProperty(j))l[j]=h[j];var k=h===null?null:h.prototype;l.prototype=Object.create(k);l.prototype.constructor=l;l.__superConstructor__=h;function l(m,n){"use strict";k.constructor.call(this,m,n||i);}l.prototype.broadcastUpdate=function(m,n){"use strict";g.handleUpdate(m,n);};e.exports=l;});
__d("SpotlightViewerBottomBar",["LeftRight.react","React","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j){var k=h.createClass({displayName:'SpotlightViewerBottomBar',render:function(){var l=Array.isArray(this.props.children)?this.props.children:[this.props.children],m="_4_8n _51an";if(this.props.className)m=j(m,this.props.className);if(l.length===1)return (h.DOM.div({className:m},l[0]));m=j(m,"_50-m");return (g({className:m},l[0],l[1]));}});e.exports=k;});
__d("SpotlightViewerBottomBarGroup",["React","cx"],function(a,b,c,d,e,f,g,h){var i=g.createClass({displayName:'SpotlightViewerBottomBarGroup',render:function(){var j=this.props.itemmargin||'right',k=((j=='left'?"marginLeft":'')+(j=='right'?' '+"marginRight":'')+(' '+"_4_8i"));return (g.DOM.div({className:k},this.props.children));}});e.exports=i;});
__d("SpotlightViewerBottomBarLink",["Link.react","React","cx"],function(a,b,c,d,e,f,g,h,i){var j=h.createClass({displayName:'SpotlightViewerBottomBarLink',render:function(){return (g({className:"_4_8j _4_8k",onClick:this.props.onClick},this.props.children));}});e.exports=j;});
__d("SpotlightViewerCheck",["Link.react","React","cx"],function(a,b,c,d,e,f,g,h,i){var j=h.createClass({displayName:'SpotlightViewerCheck',getInitialState:function(){return {selected:this.props.selected};},render:function(){var k=((this.props.selected?"_4_d3":'')+(' '+"_4_d2")+(' '+"_51an")+(' '+"_4bi")+(this.props.bounce?' '+"_3yk":''));return g({className:k,onClick:this.props.onClick});}});e.exports=j;});
__d("SpotlightViewerCroppingBar",["React","SpotlightViewerBottomBar","SpotlightViewerBottomBarGroup","SpotlightViewerBottomBarLink","cx","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=g.createClass({displayName:'SpotlightViewerCroppingBar',_getBarGroupContents:function(){if(this.props.saving)return (g.DOM.span({className:"_4_8j"},"Saving your new profile picture"));return [j({onClick:this.props.onDone},"Done Cropping"),j({onClick:this.props.onCancel},"Cancel")];},render:function(){return (h(null,i(null,this._getBarGroupContents())));}});e.exports=m;});
__d("SpotlightViewerOptionsMenu",["ContextualLayerAutoFlip","React","ReactMenu","PopoverMenu.react","SpotlightViewerBottomBarLink","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=i.Item,n=h.createClass({displayName:'SpotlightViewerOptionsMenu',_onItemClick:function(o,p){this.props.callback&&this.props.callback(p.item.getValue());},render:function(){var o=i({onItemClick:this._onItemClick},this.props.items.map(function(p){return (m({value:p.value,title:p.label,href:p.href||'#'},p.label));}));return (j({menu:o,layerBehaviors:[g],onShow:this.props.onShow,onHide:this.props.onHide},k(null,"Options")));}});e.exports=n;});
__d("SpotlightViewerUpdateUrlOnNav",["PageTransitions","URI","goURI"],function(a,b,c,d,e,f,g,h,i){function j(k){"use strict";this._viewer=k;this._registered=false;this._shouldUpdateURL=false;this._suppressNextEvent=false;}j.prototype.enable=function(){"use strict";this._registered=false;this._subscriptions=[this._viewer.subscribe('open',this._onOpen.bind(this)),this._viewer.subscribe('close',this._onClose.bind(this)),this._viewer.subscribe('url_change',this._onURLChange.bind(this))];this._enabled=true;};j.prototype.disable=function(){"use strict";for(var k=0;k<this._subscriptions.length;k++)this._subscriptions[k].unsubscribe();this._subscriptions=[];this._enabled=false;};j.prototype._registerTransition=function(){"use strict";if(this._registered)return;g.registerHandler(this._handleTransition.bind(this));this._registered=true;};j.prototype._handleTransition=function(k){"use strict";if(!this._enabled)return false;if(this._shouldUpdateURL){this._shouldUpdateURL=false;g.transitionComplete(true);return true;}this._suppressNextEvent=true;if(this._viewer.openURL(k)){g.transitionComplete();return true;}if(this._viewer.isOpen()&&k.getUnqualifiedURI().toString()==this._openURI.toString()){this._suppressNextEvent=true;this._viewer.close();g.transitionComplete();return true;}this._viewer.close();this._suppressNextEvent=true;return false;};j.prototype._onOpen=function(){"use strict";this._registerTransition();this._openURI=h.getMostRecentURI().getUnqualifiedURI();};j.prototype._onClose=function(){"use strict";if(this._suppressNextEvent){this._suppressNextEvent=false;return;}var k=this._viewer.removePermalinkQueryData(this._openURI),l=this._viewer.shouldTransitionOnClose(this._openURI);if(l){i(k);}else this._updateURL(k);};j.prototype._onURLChange=function(k,l){"use strict";if(this._suppressNextEvent){this._suppressNextEvent=false;return;}this._updateURL(l);};j.prototype._updateURL=function(k){"use strict";this._shouldUpdateURL=true;i(k);};e.exports=j;});
__d("VaultImageCache",[],function(a,b,c,d,e,f){var g=[],h={},i={addImageProvider:function(j){g.push(j);},invokeCallbackWithURL:function(j,k){if(h[j]){k(h[j]);return;}for(var l=0;l<g.length;l++){var m=g[l](j,function(n){h[j]=n;k(n);});if(m)return;}}};e.exports=i;});
__d("VaultSelectableGrid",["ArbiterMixin","AsyncRequest","CSS","CSSAnimations","DOM","DOMQuery","Event","Form","Parent","PhotosUploadWaterfall","Selectable","SubscribableSet","VaultImageCache","copyProperties","fbt","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){function w(event){var aa=event.getTarget();if(aa.classList.contains("fbVaultSelectableGridImageCheckContainer"))aa=aa.firstChild;if(!k.isNodeOfType(aa,'input')||aa.type!='checkbox')return;var ba=aa.value;if(!ba)return;if(!this.selectionSet.contains(ba)){this.selectionSet.clear();this.selectionSet.add(ba);}else this.selectionSet.remove(ba);}function x(aa,ba){this.bulkChange(function(){var ca=new r();ba.forEach(function(ea){var fa=l.find(ea,'input[type="checkbox"]');ca.add(fa.value);});var da=this.selectionSet.getLength();l.scry(this.grid,'.fbVaultSelectableGridItem input[type="checkbox"]').forEach(function(ea){if(!ca.contains(ea.value))this.selectionSet.remove(ea.value);}.bind(this));this.selectionSet.addAll(ca.getItems());if(this.waterfallID)p.sendSignal({qn:this.waterfallID,step:p.VAULT_IMAGES_SELECTED,count:this.selectionSet.getLength()-da,uploader:this.origin,source:p.GRID});});}function y(aa,ba){l.scry(aa,'input[type="checkbox"]').forEach(ba);}function z(aa,ba,ca,da,ea){this.grid=aa;this.form=o.byTag(this.grid,'form');this.waterfallID=da;this.origin=ea;this.setSelectionSet(new r(ba));this.multiselect=ca;if(this.multiselect){this._initMultiselect();}else this._initNonMultiselect();m.listen(this.form,'submit',function(){this.submitForm();return false;}.bind(this));var fa=function(ga,ha){var ia=l.scry(this.grid,'input[value="'+ga+'"]');if(ia){var ja=o.byClass(ia[0],"fbVaultSelectableGridItem");if(ja){var ka=k.scry(ja,".fbVaultSelectableGridImage img");if(ka.length>0){ha(ka[0].src);return true;}}}return false;}.bind(this);s.addImageProvider(fa);m.listen(this.grid,'click',function(event){var ga=o.byClass(event.getTarget(),'fbVaultSelectableGridImageCheckContainer');if(ga)j.bounce(ga);});}t(z,{getSerializedFormData:function(aa,ba,ca,da){var ea=n.serialize(ba),fa=k.scry(ba,'input[type="checkbox"]')[0].name;ea[fa]=aa.getItems();ea.source=da||p.GRID;ea.qn=ca;ea.application=p.APP_ARCHIVE;return ea;}});t(z.prototype,g,{selectAll:function(){this.selectable&&this.selectable.selectAll();},_initMultiselect:function(){this.selectable=new q(this.grid,'.fbVaultSelectableGridItem','fbVaultSelectableGridSelected',{lassoable:true,sticky:true});this.selectable.subscribe('selection',function(aa,ba){setTimeout(v(x,this,aa,ba),0);}.bind(this));},_initNonMultiselect:function(){m.listen(this.grid,'click',w.bind(this));},setSelectionSet:function(aa){if(aa==this.selectionSet)return;this.selectionSet=aa;this.selectionSet.subscribe('change',this.updateGridState.bind(this));this.updateGridState();},getRoot:function(){return this.grid;},getSelectedCount:function(){return this.selectionSet.getLength();},switchTab:function(aa){i.conditionClass(this.grid,'onlySelected',aa==='selected');i.conditionClass(this.grid,'onlyVault',aa==='vault');i.conditionClass(this.grid,'onlyRecent',aa==='recent');i.conditionClass(this.grid,'showingUpload',aa==='upload');},getSelectedImageIDs:function(){return this.selectionSet.getItems();},getSelectionSet:function(){return this.selectionSet;},itemsAddedOrRemoved:function(){this.selectable&&this.selectable.rematch();},bulkChange:function(aa){if(this.disableUpdates){aa.call(this);}else{this.disableUpdates=true;aa.call(this);this.disableUpdates=false;}this.updateGridState();},updateGridState:function(){if(this._disableUpdates)return;y(this.form,function(aa){var ba=aa.value,ca=this.selectionSet.contains(ba);aa.checked=ca;var da=o.byClass(aa,'fbVaultSelectableGridItem');if(da){i.conditionClass(da,'fbVaultSelectableGridSelected',ca);var ea=k.scry(da,'.fbVaultSelectableGridImageCheckTooltip');if(ea.length>0){var fa=ea[0];if(aa.checked){fa.setAttribute('aria-label',"Unselect");}else fa.setAttribute('aria-label',"Select");}}}.bind(this));i.conditionClass(this.grid,'fbVaultSelectableGridHasSelected',this.getSelectedCount()>0);this.inform('change');},submitForm:function(aa,ba){var ca=z.getSerializedFormData(this.selectionSet,this.form,this.waterfallID,ba),da=aa?o.byClass(aa,'stat_elem'):this.form;new h(this.form.action).setData(ca).setStatusElement(da).setHandler(function(ea){m.fire(this.form,'success',{response:ea});this.inform('submitted');}.bind(this)).send();},setWaterfallID:function(aa){this.waterfallID=aa;}});e.exports=z;});
__d("VaultPageGrid",["Event","Arbiter","AsyncDialog","AsyncRequest","Bootloader","CSS","DOM","DOMQuery","KeyedCallbackManager","Parent","PhotosUploadWaterfall","SubscribableSet","VaultSelectableGrid","Vector","ViewportBounds","VaultBoxURI","PageTransitions","Style","$","arrayContains","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){var ba='VaultPageGrid/registerSelectableGrid-',ca='VaultPageGrid/appendNewImages-',da=new o();function ea(fa,ga,ha,ia,ja,ka){var la=this._selectionSet=new r();ha.setSelectionSet(this._selectionSet);this._waterfallID=ka;this._form=ia;var ma={};ma[fa]=this;da.addResourcesAndExecute(ma);var na=ja.imageCount,oa=t.getElementPosition(ga).y-u.getTop();g.listen(window,'scroll',function(){var sa=t.getScrollPosition().y,ta=t.getElementDimensions(ia).y+oa;l.conditionClass(ga,'fbVaultPageFixedHeaderSticky',sa>oa&&sa<ta);});la.subscribe('change',function(){ha.setHasImagesSelected(la.getLength()>0);});var pa=function(){n.scry(ia,'.fbVaultSelectableGridSelected').forEach(function(sa){l.removeClass(sa,'fbVaultSelectableGridSelected');});n.scry(ia,'input[type="checkbox"]').forEach(function(sa){(sa.name=='vault_image_ids[]')&&(sa.checked=false);});la.clear();};ha.subscribe('cancel',function(){q.sendSignal({qn:ka,step:q.SELECT_CANCELED,uploader:q.APP_ARCHIVE});pa();});ha.subscribe('delete',function(){new j('/ajax/vault/delete.php').setData(s.getSerializedFormData(la,ia,ka)).setStatusElement(ia).send();});h.subscribe(ba+fa,function(sa,ta){this.registerSelectableGrid(ta);}.bind(this));h.subscribe(ca+fa,function(sa,ta){this.appendNewImages(ta.timestamp,ta.newGrid);}.bind(this));h.subscribe(ea.REMOVE_IMAGES_EVENT,function(sa,ta){m.scry(ia,'.fbVaultSelectableGridItem').forEach(function(va){var wa=m.find(va,'input[type="checkbox"]').value;if(z(ta,wa)){var xa=m.find(va,'.fbVaultSelectableGridImage'),ya=x.get(xa,'width'),za=x.get(xa,'height');x.set(va,'width',ya);x.set(va,'height',za);x.set(va,'line-height',za);m.setContent(va,ja.deletedIcon.cloneNode(true));l.addClass(va,'fbVaultSelectableGridDeletedImage');l.removeClass(va,'fbVaultSelectableGridItem');}});la.clear();var ua=m.scry(document.body,'.fbVaultPageGridImageCount')[0];if(ua){na-=ta.length;m.setContent(ua,na);}this._selectableGrids.forEach(function(va){va.itemsAddedOrRemoved();});}.bind(this));h.subscribe('VaultSharerDialog/imagesShared',pa);var qa=m.create('div',{className:'fbVaultPageSelectableBg'});qa.setAttribute('data-selectable','lasso');m.prependContent(y('contentCol'),qa);var ra=h.subscribe('page_transition',function(){if(!v.isVaultArchiveURI(w.getNextURI())){m.remove(qa);ra.unsubscribe();qa=null;}});}aa(ea.prototype,{_selectableGrids:[],appendNewImages:function(fa,ga){var ha=y('month_grid_'+fa+'_'),ia=m.scry(ha,'.fbVaultSelectableGrid')[0];while(ga.firstChild)ia.appendChild(ga.firstChild);m.remove(ga);this._selectableGrids.forEach(function(ja){ja.itemsAddedOrRemoved();});},registerSelectableGrid:function(fa){fa.getSelectedImageIDs().forEach(this._selectionSet.add.bind(this._selectionSet));fa.setSelectionSet(this._selectionSet);this._selectableGrids.push(fa);fa.setWaterfallID(this._waterfallID);},getSelectionSet:function(){return this._selectionSet;},createPost:function(fa){var ga=new j(this._form.action).setData(s.getSerializedFormData(this._selectionSet,this._form)).setStatusElement(p.byClass(fa,'stat_elem')).setRelativeTo(fa).setHandler(function(ha){g.fire(this._form,'success',{response:ha});}.bind(this));i.send(ga);}});aa(ea,{REMOVE_IMAGES_EVENT:'VaultPageGrid/removeImagesEvent',appendNewImages:function(fa,ga,ha){h.inform(ca+fa,{timestamp:ga,newGrid:ha},h.BEHAVIOR_PERSISTENT);},insertNewPagelet:function(fa,ga,ha){m.find(document.body,'.fbVaultPageMainPagelet').appendChild(ha);h.inform(ba+fa,ga,h.BEHAVIOR_PERSISTENT);},getInstanceWithCallback:function(fa,ga){da.executeOrEnqueue(fa,ga);},getInstance:function(fa){return da.getResource(fa);}});e.exports=ea;});
__d("SpotlightVaultViewer",["Arbiter","ArbiterMixin","AsyncDialog","AsyncRequest","BadgedButton","CSSAnimations","LoadingIndicator.react","Parent","Photocrop2","PhotosConst","PhotoStore","PhotosUploadWaterfall","PhotoUtils","ProfilePicRequestCreator","React","SpotlightViewer","SpotlightViewerAutoResize","SpotlightViewerBehaviorsMixin","SpotlightViewerBottomBar","SpotlightViewerBottomBarGroup","SpotlightViewerBottomBarLink","SpotlightViewerCheck","SpotlightViewerClose","SpotlightViewerCoreMixin","SpotlightViewerCroppingBar","SpotlightViewerDimensionMixin","SpotlightViewerOptionsMenu","SpotlightViewerPagers","SpotlightViewerPageWithKeys","SpotlightViewerUpdateUrlOnNav","SpotlightViewport","SubscriptionsHandler","URI","VaultBoxURI","VaultPageGrid","Vector","cx","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra){var sa=u.createClass({displayName:'SpotlightVaultViewer',mixins:[h,x,da,fa],behaviors:[ja,ia,w],getViewerID:function(){return 'vaultbox';},optionsMenuValues:{DOWNLOAD:0,CROP:1,ROTATE_LEFT:2,ROTATE_RIGHT:3,MAKE_COVER_PHOTO:4},getInitialState:function(){this._grid=oa.getInstance(this.props.gridid);this._subscriptions=new la();return {photoData:this._getInitialPhotoData(),open:true,selectionSet:this._grid.getSelectionSet(),croppingMode:false,savingMode:false,menuOpen:false,updatingPhoto:false,bounce:false};},_getInitialPhotoData:function(){var ta=q.getIndexForID(this.props.setid,this.props.photoid),ua=q.getByIndexImmediate(this.props.setid,ta);return ua?ua:this._getThumbnailPhotoData();},_getThumbnailPhotoData:function(){if(!this.props.normaldimensions||!this.props.thumbsrc)return null;var ta=pa.deserialize(this.props.normaldimensions),ua={id:this.props.photoid,image1:{width:ta.x,height:ta.y,uri:this.props.thumbsrc}};if(this.props.hiresdimensions){var va=pa.deserialize(this.props.hiresdimensions);ua.image2={width:va.x,height:va.y,uri:this.props.thumbsrc};}return ua;},_enableSubscriptions:function(){this._subscriptions.addSubscriptions(g.subscribe('VaultSharerDialog/imagesShared',this.close),g.subscribe('SpotlightVaultViewer/imageDeleted',this._onDelete),this.viewState.subscribe('photo_fetch',this.setState.bind(this,{photoData:null},null)));},removePermalinkQueryData:function(ta){if(na.isVaultBoxURI(ta))return new ma(ta).removeQueryData('view_image');return ta;},shouldUpdateURLOnClose:function(ta){return false;},_onShareClick:function(event){if(this.state.selectionSet.getLength()===0){this.state.selectionSet.add(this._getCurrentFBID());this.setState({selectionSet:this.state.selectionSet});}this._grid.createPost(event.target);},_onSelect:function(){var ta=this._getCurrentFBID();if(!this.state.selectionSet.contains(ta)){this.state.selectionSet.add(ta);}else this.state.selectionSet.remove(ta);this.setState({selectionSet:this.state.selectionSet,bounce:true});setTimeout(this.setState.bind(this,{bounce:false}),l.getBounceTimeout());},_onClickOptions:function(ta){if(ta==this.optionsMenuValues.CROP){this._enableCropping();}else if(ta==this.optionsMenuValues.ROTATE_LEFT){this._rotate('left');}else if(ta==this.optionsMenuValues.ROTATE_RIGHT)this._rotate('right');},_rotate:function(ta){var ua=this._getCurrentFBID(),va={fbid:ua,cs_ver:p.VIEWER_VAULTBOX};va[ta]=1;var wa=this.viewState.getPosition();new j('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(va).setFinallyHandler(this.rotationComplete.bind(this,wa)).setErrorHandler(this.rotationComplete.bind(this,wa)).setMethod('POST').setReadOnly(false).send();this.viewState.inform('photo_fetch');},rotationComplete:function(ta){if(ta==this.viewState.getPosition())q.getByIndex(this.props.setid,ta,this._updatePhoto);},_enableCropping:function(){var ta=this._dimensions.getOriginalDimensionsFromPhoto(this.state.photoData);this._photocrop=new o(this.refs.image.getDOMNode(),{},ta);this.setState({croppingMode:true});},_disableCropping:function(){this._photocrop&&this._photocrop.done(false);this.setState({croppingMode:false});},componentDidMount:function(){if(this.props.enablecropping)this._enableCropping();},_crop:function(){var ta=this._getCurrentFBID(),ua=this.state.photoData.owner.id,va=this._photocrop.done();new t(ta,ua,ua,va).setSuccessURI(new ma('profile.php').setQueryData({id:ua}).toString()).setErrorURI(ma.getRequestURI().toString()).setIsUnscaled(true).send();this.setState({croppingMode:false,savingMode:true});},_isCroppingEnabled:function(){return this.state.croppingMode||this.state.savingMode;},_delete:function(event){var ta=new j('/ajax/vault/delete.php').setData({vault_image_ids:[this._getCurrentFBID()],source:r.SPOTLIGHT_VAULT_VIEWER}).setStatusElement(n.byClass(event.target,'stat_elem')).setRelativeTo(event.target);i.send(ta);},_onDelete:function(){this.close();q.clearSetCache(this.props.setid);},openURL:function(ta){var ua=ta.getQueryData('view_image').view_image;if(!ua)return false;this.viewState.page(this.viewState.getRelativeMovement(ua));return true;},isValidURL:function(ta){return na.isVaultArchiveURI(ta);},_getBottomBar:function(){if(!this.state.photoData)return null;if(this._isCroppingEnabled())return (ea({onDone:this._crop,onCancel:this._disableCropping,saving:this.state.savingMode}));return (y({className:"stat_elem"},z(null,aa({onClick:this._delete},"Delete"),this._getOptionsMenu(),u.DOM.div({className:"_4_8j"},m({size:m.SIZES.small,color:m.COLORS.blue,showonasync:true,className:"_535k"}))),z({itemmargin:"left"},k({onClick:this._onShareClick,className:"_4_8j",count:this.state.selectionSet.getLength(),singularLabel:"Share Photo",pluralLabel:"Share Photos",bounce:this.state.bounce}))));},_getCheck:function(){if(!this.state.photoData||this._isCroppingEnabled())return null;var ta=this.state.selectionSet.contains(this._getCurrentFBID());return (ba({bounce:this.state.bounce,selected:ta,onClick:this._onSelect}));},_getPagers:function(){if(this._isCroppingEnabled())return null;return ha(null);},_getOptionsMenu:function(){if(!this.state.photoData)return null;var ta=[],ua=s.getDownloadURLFromData(this.state.photoData);if(ua)ta.push({label:"Download",value:this.optionsMenuValues.DOWNLOAD,href:s.getDownloadURLFromData(this.state.photoData)});if(this.state.photoData.owner)ta.push({label:"Make Profile Picture",value:this.optionsMenuValues.CROP});if(s.canViewerMakeCoverPhoto(this.state.photoData))ta.push({label:"Make Cover Photo",value:this.optionsMenuValues.MAKE_COVER_PHOTO,href:s.getCoverPhotoURLFromData(this.state.photoData)});ta.push({label:"Rotate Left",value:this.optionsMenuValues.ROTATE_LEFT});ta.push({label:"Rotate Right",value:this.optionsMenuValues.ROTATE_RIGHT});return (ga({items:ta,callback:this._onClickOptions,onShow:this.setState.bind(this,{menuOpen:true},null),onHide:this.setState.bind(this,{menuOpen:false},null)}));},render:function(){var ta=this.getMedia(),ua=this.getStageDimensions();return (v({open:this.state.open,onHide:this.close},ka({active:this.state.menuOpen,onClick:this._onClickViewport,stageDimensions:ua,media:ta,showLoadingIndicator:!this.state.photoData},ca({onClick:this.close,position:"left"}),this._getCheck(),this._getBottomBar(),this._getPagers())));}});e.exports=sa;});
__d("SpotlightViewerInit",["DOM","React"],function(a,b,c,d,e,f,g,h){var i={render:function(j,k){var l=g.create('div');j=h.renderComponent(j,l);g.appendContent(document.body,l);j.subscribeOnce('close',function(){j.unmountComponent();g.remove(l);k&&k();});}};e.exports=i;});
__d("VaultBoxInit",["AsyncRequest","DOM","PhotoStore","SpotlightVaultViewer","SpotlightViewerInit","VaultPageGrid"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m={setID:'vault:images_by_date_taken',bootstrapWithElem:function(n){k.render(j({open:true,gridid:n.getAttribute('data-grid-id'),setid:m.setID,photoid:n.getAttribute('data-fbid'),thumbsrc:h.find(n,'img').src,hiresdimensions:n.getAttribute('data-hi-res-dimensions'),normaldimensions:n.getAttribute('data-normal-dimensions')}));if(!i.hasBeenCreated(m.setID))new g('/ajax/photos/vaultbox/init_react.php').setRelativeTo(n).setData({photoID:n.getAttribute('data-fbid')}).send();},bootstrapFromPermalink:function(n,o,p,q){l.getInstanceWithCallback(p,function(){k.render(j({open:true,setid:m.setID,initialpayload:n,photoid:o,gridid:p,enablecropping:q.enableCropping}));});}};e.exports=m;});
__d("VaultBadgedButton",["Button","CSS","CSSAnimations","DOM","copyProperties","csx","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=99;function o(p,q,r){this._root=p;this._countEl=j.find(this._root,"._foq");this._buttonEl=j.find(this._root,"._for");this._singularLabel=q.singular;this._pluralLabel=q.plural;this._isDisabledWhenEmpty=r.isDisabledWhenEmpty;this._useDynamicText=r.useDynamicText;this._selectionSet=null;}k(o.prototype,{setSelectionSet:function(p){this._changeSubscription&&this._changeSubscription.unsubscribe();this._selectionSet=p;this._changeSubscription=this._selectionSet.subscribe('change',this._refresh.bind(this));this._refresh();},_refresh:function(){var p=0,q;if(this._selectionSet){p=this._selectionSet.getLength();q=p>n?n+'+':p;}var r=p===0;h.conditionShow(this._countEl,!r);h.conditionClass(this._countEl,"_2dqp",p>n);j.setContent(this._countEl,q);if(this._useDynamicText)g.setLabel(this._buttonEl,p>1?this._pluralLabel:this._singularLabel);if(!r){g.setEnabled(this._buttonEl,true);i.bounce(this._countEl);}else g.setEnabled(this._buttonEl,!this._isDisabledWhenEmpty);}});e.exports=o;});
__d("VaultArchiveButtonHeader",["ArbiterMixin","CSS","Event","copyProperties"],function(a,b,c,d,e,f,g,h,i,j){function k(l,m,n,o,p){this._badgedButton=l;this._deleteCancelButtonsContainer=m;i.listen(n,'click',this.inform.bind(this,'delete'));i.listen(o,'click',this.inform.bind(this,'cancel'));this._privacyNotice=p;}j(k.prototype,g,{setSelectionSet:function(l){this._badgedButton.setSelectionSet(l);},setHasImagesSelected:function(l){h.conditionShow(this._deleteCancelButtonsContainer,l);h.conditionShow(this._privacyNotice,!l);}});e.exports=k;});